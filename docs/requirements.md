# オヤカツ 要件定義書

## 1. プロジェクト概要

### 1.1 アプリ名
オヤカツ

### 1.2 コンセプト
推し活パロディ × 家族の仕送りアプリ

### 1.3 ワンライナー
離れて暮らす子供に「貢ぐ」ことで、通話や写真がもらえる。親のための推し活アプリ。

### 1.4 ターゲットユーザー
- **メインターゲット**: 離れて暮らす大学生〜社会人の子供を持つ親世代（課金側）
- **サブターゲット**: 一人暮らしの大学生・若手社会人（コンテンツ提供側）

---

## 2. 機能要件

### 2.1 認証・アカウント機能

| 項目 | 仕様 |
|------|------|
| 認証方式 | 電話番号+SMS認証、メール+パスワード（両方対応） |
| 年齢制限 | なし |
| アカウントタイプ | 親 / 子供 |

### 2.2 ファミリー機能

| 項目 | 仕様 |
|------|------|
| ファミリー作成 | 親が作成 |
| 招待方式 | 招待リンク/コード |
| 子供の参加 | 招待リンクから自己登録、自動参加（承認フロー不要） |
| 子供の所属 | 単一ファミリーのみ |
| 子供の人数 | 複数人登録可能（兄弟など） |
| 最大人数 | 10人まで |

### 2.3 通話機能

| 項目 | 仕様 |
|------|------|
| 実装方式 | WebRTC（アプリ内通話） |
| 通話タイプ | ビデオ通話 / 音声通話 |
| 発信方向 | 双方向（親→子供、子供→親） |
| 通話リクエスト有効期限 | 24時間 |
| 報酬発生 | 両方向の通話で発生 |

#### 報酬計算方式
- **固定報酬**: 1回あたり○○円（親が設定）
- **時間単位報酬**: 通話時間×単価（親が設定）
- 親が固定/時間単位を選択可能
- 子供ごとに個別の報酬設定が可能

### 2.4 写真投稿機能

| 項目 | 仕様 |
|------|------|
| 報酬 | 写真1枚あたり○○円（親が設定） |
| 公開範囲 | ファミリー全員公開 or 特定メンバーへの個別送信 |
| リアクション | シンプルなスタンプリアクション（MVP） |
| 保存期間 | 1年間 |

### 2.5 報酬管理機能

| 項目 | 仕様 |
|------|------|
| 報酬設定 | 親が子供ごとに個別設定 |
| 支払いステータス | 子供が「受領確認」して完了 |
| 未払い累積表示 | なし（履歴で確認） |
| 送金方法 | 外部サービス（PayPay、銀行振込等） |
| 履歴保存期間 | 無期限 |

### 2.6 家族内ランキング機能

| 項目 | 仕様 |
|------|------|
| 対象 | 親のみ（貢ぎ額で競争） |
| 集計期間 | 月間 |
| リセット | 毎月1日 |

### 2.7 称号システム

| 月間貢ぎ額 | 称号 |
|-----------|------|
| 〜1万円 | 見守り隊 |
| 1万円〜5万円 | 心の支え |
| 5万円〜 | 神推し |

- 固定称号のみ（カスタマイズ不可）
- 毎月の集計で自動更新
- 子供に昇格通知を送信

### 2.8 プッシュ通知

| 通知イベント | 対象 |
|-------------|------|
| 通話リクエスト受信 | 子供 |
| 写真投稿 | 親（ファミリーメンバー） |
| 報酬確定 | 親・子供 |

- 通知設定は一括ON/OFFのみ

---

## 3. 画面構成

### 3.1 親側の画面
1. **ホーム**: 子供の最新投稿、通話リクエストボタン
2. **タイムライン**: 子供の写真投稿一覧
3. **ランキング**: 家族内の貢ぎランキング
4. **マイページ**: 自分の称号、累計貢ぎ額、報酬設定

### 3.2 子供側の画面
1. **ホーム**: 今月の獲得報酬、通話リクエスト通知
2. **投稿**: 写真投稿画面
3. **履歴**: 報酬履歴（誰からいくらもらったか）
4. **ファミリー**: 登録済みの家族一覧、各称号

---

## 4. ユーザーフロー

### 4.1 初回登録フロー（親）
```
1. アプリダウンロード
2. 電話番号 or メールで新規登録
3. 「親」としてアカウント作成
4. ファミリー作成（ファミリー名設定）
5. 報酬設定（通話・写真の報酬額）
6. 招待リンク生成 → 子供に共有
```

### 4.2 初回登録フロー（子供）
```
1. 招待リンクを開く
2. アプリダウンロード（未インストールの場合）
3. 電話番号 or メールで新規登録
4. 「子供」としてアカウント作成
5. ファミリーに自動参加
```

### 4.3 通話フロー
```
1. 親 or 子供が通話リクエスト送信
2. 相手にプッシュ通知
3. 相手が応答 → 通話開始
4. 通話終了
5. 報酬が確定・記録
6. 親に送金リマインド
7. 親が外部サービスで送金
8. 子供が「受領確認」
```

### 4.4 写真投稿フロー
```
1. 子供が写真撮影 or 選択
2. 公開範囲を選択（全員 or 個別）
3. 投稿
4. ファミリーメンバーに通知
5. 報酬が確定・記録
6. 親が外部サービスで送金
7. 子供が「受領確認」
```

---

## 5. 非機能要件

### 5.1 プラットフォーム
- iOS / Android ネイティブアプリ
- React Native

### 5.2 バックエンド
- Node.js
- PostgreSQL

### 5.3 性能要件

| 項目 | 要件 |
|------|------|
| 想定同時接続数 | 〜1,000人（MVP） |
| 通話品質 | WebRTC標準品質 |
| API応答時間 | 95%ile < 500ms |

### 5.4 可用性
- 目標稼働率: 99.5%
- オフライン対応: なし（オンライン必須）

### 5.5 セキュリティ
- 通信: HTTPS/TLS
- 通話: E2E暗号化（WebRTC標準）
- 認証トークン: JWT
- パスワード: bcryptハッシュ

### 5.6 データ保存
| データ種別 | 保存期間 |
|-----------|---------|
| 写真 | 1年間 |
| 報酬履歴 | 無期限 |
| 通話履歴 | 無期限 |
| アカウント情報 | 退会まで |

### 5.7 国際化
- 日本語のみ（MVP）

---

## 6. 技術スタック

### 6.1 フロントエンド
- **フレームワーク**: React Native
- **状態管理**: Redux Toolkit or Zustand
- **通話**: WebRTC (react-native-webrtc)

### 6.2 バックエンド
- **ランタイム**: Node.js
- **フレームワーク**: Express or Fastify
- **ORM**: Prisma
- **データベース**: PostgreSQL

### 6.3 インフラ
- **クラウド**: AWS or GCP
- **ストレージ**: S3 / Cloud Storage（写真）
- **プッシュ通知**: Firebase Cloud Messaging

### 6.4 外部サービス
- **SMS認証**: Twilio or AWS SNS
- **WebRTC TURN/STUN**: Twilio or 自前構築

---

## 7. データモデル（概要）

### 7.1 主要エンティティ

```
User
├── id
├── phone_number (nullable)
├── email (nullable)
├── password_hash
├── display_name
├── role (parent | child)
├── created_at
└── updated_at

Family
├── id
├── name
├── invite_code
├── created_by (user_id)
├── created_at
└── updated_at

FamilyMember
├── id
├── family_id
├── user_id
├── role (parent | child)
├── joined_at
└── status

RewardSetting
├── id
├── family_id
├── parent_id
├── child_id
├── call_reward_type (fixed | per_minute)
├── call_reward_amount
├── photo_reward_amount
├── created_at
└── updated_at

Call
├── id
├── family_id
├── caller_id
├── callee_id
├── type (video | audio)
├── duration_seconds
├── started_at
├── ended_at
└── status

Photo
├── id
├── family_id
├── uploader_id
├── image_url
├── visibility (all | specific)
├── uploaded_at
└── expires_at

PhotoRecipient
├── id
├── photo_id
├── user_id
└── created_at

Reaction
├── id
├── photo_id
├── user_id
├── type (stamp種別)
└── created_at

Reward
├── id
├── family_id
├── parent_id
├── child_id
├── source_type (call | photo)
├── source_id
├── amount
├── status (pending | confirmed)
├── confirmed_at
└── created_at

Ranking
├── id
├── family_id
├── user_id
├── month (YYYY-MM)
├── total_amount
├── rank
└── title_id

Title
├── id
├── name
├── min_amount
└── max_amount
```

---

## 8. MVP除外項目（将来検討）

以下の機能はMVPには含めず、将来的に検討する:

- メッセージ返信への報酬
- 動画投稿機能
- 生誕祭（誕生日・合格祝い等のイベント機能）
- 実家からの差し入れ（米・野菜等）連携
- 全国ランキング（匿名表示）
- コメント機能
- 通知の個別設定
- 称号のカスタマイズ
- 多言語対応
- オフライン対応

---

## 9. 改訂履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2026-01-14 | 1.0 | 初版作成 |
